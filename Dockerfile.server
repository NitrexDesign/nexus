FROM golang:1.25-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN go build -o nexus ./cmd/server/main.go

FROM alpine:3.19
WORKDIR /app
RUN addgroup -g 1000 app && adduser -u 1000 -G app -s /bin/sh -D app

COPY --from=builder --chown=1000:1000 /app/nexus .
RUN mkdir -p /app/data /app/data/icons && chown -R 1000:1000 /app

USER app

ENV PORT=8080
ENV API_PORT=8081

EXPOSE 8080 8081

CMD ["./nexus"]
